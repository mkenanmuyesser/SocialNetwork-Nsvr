@model NeSever.Common.Models.FrontEnd.HediyeSepetiVM

<div class="main-header m-1">
    <div class="content-bg-wrap bg-birthday"></div>
    <div class="container">
        <div class="row">
            <div class="col col-lg-8 m-auto col-md-8 col-sm-12 col-12">
                <div class="main-header-content">
                    <h1>Hediye Sepeti</h1>
                    <p>
                        Seçilen bütün hediyeler burada...
                    </p>
                </div>
            </div>
        </div>
    </div>

    <img class="img-bottom" src="/Uploads/Site/banner_dogum_gunu.png" alt="friends">
</div>

<div class="ui-block responsive-flex">
    <div class="ui-block-title">
        <div class="h6">Sıralama Tercihleri</div>
        <form class="w-search">
            <div class="form-group ">
                <div class="w-select" style="padding-right:0px!important">
                    <fieldset class="form-group">
                        <select id="s" name="s" class="selectpicker form-control">
                            <option value="FGAR " selected="@(Model.Siralama == "FGAR" || Model.Siralama == "" ? "selected" :null)">Fiyata Göre (Artan)</option>
                            <option value="FGAZ " selected="@(Model.Siralama == "FGAZ" ? "selected" :null)">Fiyata Göre (Azalan)</option>
                        </select>
                    </fieldset>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="container">

    <div class="row">
        <div class="col col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            @*<iframe width="100%" height="320" src="https://www.youtube-nocookie.com/embed/ddgsGdHpc0M?controls=0" frameborder="0" allow="autoplay; encrypted-media; gyroscope; " allowfullscreen></iframe>*@
            @if (!Model.HediyeList.Any())
            {
                @if (Model.ArkadasProfil)
                {
                    <div class="align-center pb80 pt80">
                        <p>
                            <h3>Hediye sepetine henüz hediye eklenmedi.</h3>
                        </p>
                    </div>
                }
                else
                {
                    <div class="align-center pb80 pt80">
                        <p>
                            <h3>Hediye sepetinize henüz hediye eklemediniz</h3>
                        </p>
                        <p>
                            <h3>Hediye eklemek için <a href="/Hediye/Ara/?q">tıklayınız.</a></h3>
                        </p>
                    </div>
                }
            }
        </div>
    </div>
    <div class="row ">
        <div class="row" style="width:100%">
            @if (Model.HediyeList.Any())
            {
                foreach (var urun in Model.HediyeList)
                {
                    <div class="col col-xl-4 col-lg-6 col-md-6 col-sm-6 col-12">
                        <div class="shop-product-item">
                            <div class="product-thumb" style="background-color:transparent;">
                                <a href="/Hediye/Detay/@urun.UrunId" style="width:100%; text-align:center">
                                    <img class="lazy" src="/Uploads/Site/loading_250_250.gif" data-src="@urun.ResimUrl" alt="product" style="height:250px;">
                                </a>
                            </div>

                            <div class="product-content">
                                <div class="block-title">
                                    <a href="/Hediye/Detay/@urun.UrunId" class="product-category">@urun.MarkaAdi</a>
                                    <a href="/Hediye/Detay/@urun.UrunId" class="h5 title">@urun.UrunAdi</a>
                                </div>
                                @if (!Model.ArkadasProfil)
                                {
                                    <div class="block-price">
                                        <a href="javascript:;" class="in-cart" style="background-color:red;" title="Sil" onclick="hediyeSepetindenSil('@urun.UrunId');">
                                            <svg class="olymp-shopping-bag-icon">
                                                <title>Sil</title>
                                                <use xlink:href="#olymp-little-delete"> <title>Sil</title></use>
                                            </svg>
                                        </a>
                                    </div>
                                }
                                else
                                {
                                    <div class="block-price">
                                        <a href="javascript:;" class="in-cart" style="opacity: 50 !important; background-color: #ff5e3a !important;" title="Hediye Sepetine Ekle" onclick="hediyeSepetineEkleProfil('@urun.UrunId', '@urun.HediyeSepetindekiUrunAdeti');">
                                            <svg class="olymp-shopping-bag-icon">
                                                <title>Hediye Sepetine Ekle</title>
                                                <use xlink:href="#olymp-like-post-icon">
                                                    <title>Hediye Sepetine Ekle</title>
                                                </use>
                                            </svg>
                                        </a>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }

                <div class="col col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 align-center pb80 pt80">
                    <nav aria-label="Page navigation">
                        @Html.PagedListPager((IPagedList)Model.HediyeList, page => Url.Action("HediyeSepetiPartial",
                        new
                        {
                            p = page,
                            ap = Model.KullaniciAdi,
                            o = Context.Request.Query["o"],
                        }),
                        PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(
                        new PagedListRenderOptions
                        {
                            UlElementClasses = new string[] { "pagination justify-content-center" },
                            LiElementClasses = new string[] { "page-item" },
                            ActiveLiElementClass = "page-item active",
                            PageClasses = new string[] { "page-link" },
                            EllipsesFormat = "<a class='page-link' style='padding:12px 0px 0px 0px; border:none;'>...</a>",
                            Display = PagedListDisplayMode.Always,
                            DisplayLinkToFirstPage = PagedListDisplayMode.Always,
                            DisplayLinkToLastPage = PagedListDisplayMode.Always,
                            DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
                            DisplayLinkToNextPage = PagedListDisplayMode.Always,
                            MaximumPageNumbersToDisplay = 5,
                            ContainerDivClasses = null,
                        },
                        new AjaxOptions
                        {
                            HttpMethod = "GET",
                            UpdateTargetId = "targetElement",
                            OnBegin = "onHediyeSepetiAjaxBegin",
                            OnSuccess = "onHediyeSepetiAjaxSuccess",
                            OnFailure = "onHediyeSepetiAjaxFailure"
                        }))
                    </nav>
                </div>
            }
        </div>
    </div>

</div>

<partial name="~/Views/Shared/Partials/UyeHediye.cshtml" />
<script type="text/javascript" charset="utf-8">
    $('.lazy').Lazy({
        scrollDirection: 'vertical',
        effect: 'fadeIn',
        visibleOnly: true,
        onError: function (element) {
            console.log('error loading ' + element.data('src'));
        }
    });
</script>
<script type="text/javascript">
        $(".selectpicker").selectpicker();
        function hediyeSepetindenSil(id) {

            Swal.fire({
                title: '',
                text: "Hediye sepetinden çıkarmak istediğine emin misin?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Evet, Çıkar!',
                cancelButtonText: 'Hayır'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: "/Hediye/KullaniciHediyeSil/" + id,
                        type: "GET",
                        dataType: 'json',
                        contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                        success: function (data) {
                            if (data.error == true) {
                                if (data.operation == "message") {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Upps',
                                        text: data.message,
                                        confirmButtonText: "Tamam"
                                    })
                                }
                            }
                            else {
                                hediyeSepetiGetir();

                                var hediyeSepetiSayi = $('#hediyeSepetiSayi').text();
                                $('#hediyeSepetiSayi').text(hediyeSepetiSayi - 1);

                                var hediyeSepetiSayiMobil = $('#hediyeSepetiSayiMobil').text();
                                $('#hediyeSepetiSayiMobil').text(hediyeSepetiSayiMobil - 1);

                                Swal.fire({
                                    icon: 'success',
                                    title: 'Evvet!',
                                    text: "Hediye sepetinizden kaldırıldı.",
                                    confirmButtonText: "Tamam"
                                })
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            console.log("hata!");
                        }
                    });
                }
            })

        }
        $('#s').on('change', function () {
            onHediyeSepetiAjaxBegin();
            var s = $('#s').children("option:selected").val();
            $.ajax({
                url: "/Kullanici/HediyeSepetiPartial?ap=@Html.Raw(Model.KullaniciAdi)&o=" + s,
                type: "GET",
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (data) {
                    onHediyeSepetiAjaxSuccess(data);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("hata!");
                }
            });
        });

        function onHediyeSepetiAjaxBegin(data, status, xhr) {
            showLoading();
        }

        function onHediyeSepetiAjaxSuccess(data, status, xhr) {
            hideLoading();

            var middleContent = $('#middleContent');
            middleContent.html('');
            middleContent.html(data);
        }

        function onHediyeSepetiAjaxFailure(xhr, status, error) {
            $("#targetElement").html("<strong>İşlem sırasında bir hata oluştu:" + error + "<br/>.</strong>");
        }

        function hediyeSepetineEkleProfil(id, adet) {
            $.ajax({
                url: "/Hediye/KullaniciHediyeEkle/" + id,
                type: "GET",
                dataType: 'json',
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (data) {
                    if (data.error == true) {
                        if (data.operation == "show") {
                            ShowModalSepeteEkle(adet);
                        }
                        else if (data.operation == "message") {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Uyarı!',
                                text: data.message,
                                confirmButtonText: "Tamam"
                            })
                        }
                    }
                    else {
                        Swal.fire({
                            icon: 'success',
                            title: 'Evvet!',
                            text: "Hediye sepetinize eklendi.",
                            confirmButtonText: "Tamam"
                        })
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("hata!");
                }
            });
        }

        function ShowModalSepeteEkle(adet) {
            $('#hediyeSepetiToplamUrunSayisi').html(adet);
            $('#hediyeEkleModal').modal('show');
        }
</script>

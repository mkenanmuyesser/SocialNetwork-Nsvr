@model IPagedList<NeSever.Common.Models.Uyelik.ProfilEngelKisiVM>

<div class="ui-block">
    <div class="ui-block-title">
        <h6 class="title">Engellenen Profil Listesi</h6>
    </div>

    <ul class="notification-list friend-requests">
        @if (!Model.Any())
        {
            <li>
                <div class="notification-event">
                    Engellenen Profil Bulunmamaktadır...
                </div>
            </li>
        }
        else
        {
            @foreach (var engellenenProfil in Model)
            {
                <li id="@engellenenProfil.ProfilEngellenenKullaniciId">
                    <div class="author-thumb">
                        <img src="@engellenenProfil.ProfilResmiBase64" style="height:42px; width:42px" alt="author">
                    </div>
                    <div class="notification-event">
                        <a href="/Kullanici/Profil/@engellenenProfil.KullaniciAdi" class="h6 notification-friend">@engellenenProfil.Adi @engellenenProfil.Soyadi (@engellenenProfil.KullaniciAdi)</a>
                        <span class="chat-message-item">@engellenenProfil.KayitTarihi</span>
                    </div>
                    <span class="notification-icon">
                        <a href="javascript:;" onclick="profilEngelSil('@engellenenProfil.ProfilEngellenenKullaniciId')" class="accept-request bg-red">
                            <span class="icon-minus" style="content:none;">
                                <svg class="olymp-happy-face-icon"><use xlink:href="#olymp-close-icon"></use></svg>
                            </span>
                            Engel Listesinden Kaldır
                        </a>
                    </span>
                </li>
            }
        }
    </ul>
</div>

@if (Model.Any())
{
    <nav aria-label="Page navigation">
        @Html.PagedListPager((IPagedList)Model, page => Url.Action("EngellenenProfilListesiPartial", new
        {
            p = page,
        }),
                    PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(
                    new PagedListRenderOptions
                    {
                        UlElementClasses = new string[] { "pagination justify-content-center" },
                        LiElementClasses = new string[] { "page-item" },
                        ActiveLiElementClass = "page-item active",
                        PageClasses = new string[] { "page-link" },
                        EllipsesFormat = "<a class='page-link' style='padding:12px 0px 0px 0px; border:none;'>...</a>",
                        Display = PagedListDisplayMode.Always,
                        DisplayLinkToFirstPage = PagedListDisplayMode.Always,
                        DisplayLinkToLastPage = PagedListDisplayMode.Always,
                        DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
                        DisplayLinkToNextPage = PagedListDisplayMode.Always,
                        MaximumPageNumbersToDisplay = 5,
                        ContainerDivClasses = null,
                    },
                    new AjaxOptions
                    {
                        HttpMethod = "GET",
                        UpdateTargetId = "targetElement",
                        OnBegin = "onAjaxBegin",
                        OnSuccess = "onAjaxSuccess",
                        OnFailure = "onAjaxFailure"
                    }))
    </nav>
}

<script type="text/javascript">
    function profilEngelSil(id) {
        Swal.fire({
            title: '',
            text: "Engel listesinden kaldırmak istediğine emin misin?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Evet, engeli kaldır!',
            cancelButtonText: 'Hayır'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: "/Kullanici/ProfilEngelSil",
                    type: "POST",
                    data: { ProfilEngellenenKullaniciId: id },
                    success: function (data) {
                        if (data.error == true) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Hata!',
                                text: data.message,
                                confirmButtonText: "Tamam"
                            });
                            
                        }
                        else {
                            Swal.fire({
                                icon: 'success',
                                title: 'Başarılı!',
                                text: "Seçtiğiniz kişi engel listesinden kaldırılmıştır.",
                                confirmButtonText: "Tamam"
                            });
                            var profilEngelSayisi = $('#profilEngelSayisi').text();
                            $('#profilEngelSayisi').text(parseInt(profilEngelSayisi) - 1);

                            var profilEngelSayisiMobil = $('#profilEngelSayisiMobil').text();
                            $('#profilEngelSayisiMobil').text(parseInt(profilEngelSayisi) - 1);

                               var middleContent = $('#middleContent');
                               middleContent.html('');
                               middleContent.load('@Url.Action("EngellenenProfilListesiPartial", "Kullanici")');
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        console.log("hata!");
                        console.log(textStatus);
                        console.log(errorThrown);
                    }
                });
            }
        })
    }

    function onAjaxBegin(data, status, xhr) {
        //showLoading();
    }

    function onAjaxSuccess(data, status, xhr) {
        //hideLoading();

        var middleContent = $('#middleContent');
        middleContent.html('');
        middleContent.html(data);
    }

    function onAjaxFailure(xhr, status, error) {
        $("#targetElement").html("<strong>İşlem sırasında bir hata oluştu:" + error + "<br/>.</strong>");
    }
</script>
@model IPagedList<NeSever.Common.Models.Uyelik.KullaniciBildirimVM>

<div class="ui-block">
    <div class="ui-block-title">
        <h6 class="title">Bildirimler</h6>
        @*<a href="#" class="more"><svg class="olymp-three-dots-icon"><use xlink:href="#olymp-three-dots-icon"></use></svg></a>*@
    </div>
    @if (!Model.Any())
    {
        <div class="align-center pb80 pt80">
            <p>
                <h3>Henüz bildiriminiz yoktur.</h3>
            </p>
        </div>
    }
    else
    {
        <ul class="notification-list">
            @foreach (var bildirim in Model)
            {
                <li class="@(bildirim.OkunduMu?"":"un-read")">
                    @if (bildirim.AktifMi)
                    {
                        /* <div class="author-thumb">
                             <img src="@bildirim.IlgiliKullaniciProfilResimBase64" alt="author" style="max-width:36px; height:36px">
                         </div>*/
                    <div class="notification-event">
                        <!--<a href="javascript:;" class="h6 notification-friend"></a>-->


                        @switch (bildirim.BildirimTipId)
                        {
                            case 1:
                                @Html.Raw(@bildirim.BildirimIcerik)
                                break;
                            case 2:
                                @Html.Raw(@bildirim.BildirimIcerik)
                                break;
                            case 3:
                                @Html.Raw(@bildirim.BildirimIcerik)
                                break;
                            case 6:
                                @Html.Raw(@bildirim.BildirimIcerik)
                                break;
                            case 7:
                                @Html.Raw(@bildirim.BildirimIcerik)
                                /*<a href="/Kullanici/Profil/@bildirim.IlgiliKullaniciAdi" class="notification-link">Profile Gözat</a>*/
                                break;
                            case 4:
                                /*<a href="javascript:;" class="notification-link">Mesajını Oku</a>*/
                                @Html.Raw(@bildirim.BildirimIcerik)
                                break;
                            case 5:
                                /*<a href="javascript:;" class="notification-link">Kartına Bak</a>*/
                                @Html.Raw(@bildirim.BildirimIcerik)
                                break;
                            case 8:
                                /*<a href="javascript:;" class="notification-link">Hediyeye Bak</a>*/
                                @Html.Raw(@bildirim.BildirimIcerik)
                                break;
                        }

                        <span class="notification-date"><time class="entry-date updated">@bildirim.KayitTarihi</time></span>
                    </div>
                    }
                    else
                    {
                        <div class="author-thumb">
                            <img src="~/Uploads/Site/notification.png" />
                        </div>
                        <div class="notification-event">
                            <a href="#" class="h6 notification-friend"></a> @Html.Raw(@bildirim.BildirimIcerik)

                            <span class="notification-date"><time class="entry-date updated">@bildirim.KayitTarihi</time></span>
                        </div>
                    }

                    @switch (bildirim.BildirimTipId)
                    {
                        case 1:
                            <span class="notification-icon">
                                    <svg class="olymp-calendar-icon"><use xlink:href="#olymp-cupcake-icon"></use></svg>
                            </span>
                            break;
                        case 2:
                            <span class="notification-icon">
                                    <svg class="olymp-calendar-icon"><use xlink:href="#olymp-calendar-icon"></use></svg>
                            </span>
                            break;
                        case 3:
                            <span class="notification-icon">
                                    <svg class="olymp-happy-face-icon"><use xlink:href="#olymp-happy-face-icon"></use></svg>
                            </span>
                            break;
                        case 4:
                            <span class="notification-icon">
                                    <svg class="olymp-comments-post-icon"><use xlink:href="#olymp-comments-post-icon"></use></svg>
                            </span>                          
                            break;
                        case 5:
                            <span class="notification-icon">
                                    <svg class="olymp-heart-icon"><use xlink:href="#olymp-heart-icon"></use></svg>
                            </span>
                            break;
                        case 6:
                            <span class="notification-icon">
                                    <svg class="olymp-heart-icon"><use xlink:href="#olymp-heart-icon"></use></svg>
                            </span>
                            break;
                        case 7:
                            <span class="notification-icon">
                                    <svg class="olymp-calendar-icon"><use xlink:href="#olymp-plus-icon"></use></svg>
                            </span>
                            break;
                        case 8:
                            <span class="notification-icon">
                                    <svg class="olymp-calendar-icon"><use xlink:href="#olymp-star-icon"></use></svg>
                            </span>
                            break;
                    }

                    <!--<div class="more">
                        <a href="#">
                            <svg class="olymp-little-delete"><use xlink:href="#olymp-little-delete"></use></svg>
                        </a>
                    </div>-->
                </li>

            }

            @*<li>
                    <div class="notification-event">
                        <a href="#" class="h6 notification-friend">Ad Soyad</a> senin profiline baktı.<a href="#" class="notification-link"> Mesaj At</a>
                        <span class="notification-date"><time class="entry-date updated" datetime="01.01.2020 01:00">01.01.2020 01:00</time></span>
                    </div>
                </li>
                <li>
                    <div class="notification-event">
                        <a href="#" class="h6 notification-friend">Ad Soyad</a> sana hediye kartı gönderdi.<a href="#" class="notification-link"> Kartına Bak</a>
                        <span class="notification-date"><time class="entry-date updated" datetime="01.01.2020 01:00">01.01.2020 01:00</time></span>
                    </div>
                </li>
                <li>
                    <div class="notification-event">
                        <a href="#" class="h6 notification-friend">Ad Soyad</a> sana mesaj attı.<a href="#" class="notification-link"> Mesaj At</a>
                        <span class="notification-date"><time class="entry-date updated" datetime="01.01.2020 01:00">01.01.2020 01:00</time></span>
                    </div>
                </li>
                <li>
                    <div class="notification-event">
                        <a href="#" class="h6 notification-friend">Ad Soyad</a> senin hediye sepetindeki bir ürünü kendi sepetine ekledi.
                        <span class="notification-date"><time class="entry-date updated" datetime="01.01.2020 01:00">01.01.2020 01:00</time></span>
                    </div>
                </li>
                <li>
                    <div class="notification-event">
                        <a href="#" class="h6 notification-friend">Ad Soyad</a> kendi sepetine hediye ekledi.
                        <span class="notification-date"><time class="entry-date updated" datetime="01.01.2020 01:00">01.01.2020 01:00</time></span>
                    </div>
                </li>*@
        </ul>
        <a href="javascript:;" onclick="TumBildirimleriSil();" class="btn btn-danger btn-sm" style="margin-left:10px; margin-top:10px;">Tümünü Sil</a>
    }
</div>

@if (Model.Any())
{
    <div class="col col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 align-center pb80 pt80">
        <nav aria-label="Page navigation">
            @Html.PagedListPager((IPagedList)Model, page => Url.Action("BildirimlerPartial",
            new
            {
               p = page
            }),
            PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(
            new PagedListRenderOptions
            {
                UlElementClasses = new string[] { "pagination justify-content-center" },
                LiElementClasses = new string[] { "page-item" },
                ActiveLiElementClass = "page-item active",
                PageClasses = new string[] { "page-link" },
                EllipsesFormat = "<a class='page-link' style='padding:12px 0px 0px 0px; border:none;'>...</a>",
                Display = PagedListDisplayMode.Always,
                DisplayLinkToFirstPage = PagedListDisplayMode.Always,
                DisplayLinkToLastPage = PagedListDisplayMode.Always,
                DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
                DisplayLinkToNextPage = PagedListDisplayMode.Always,
                MaximumPageNumbersToDisplay = 5,
                ContainerDivClasses = null,
            },
            new AjaxOptions
            {
                HttpMethod = "GET",
                UpdateTargetId = "targetElement",
                OnBegin = "onAjaxBegin",
                OnSuccess = "onAjaxSuccess",
                OnFailure = "onAjaxFailure"
            }))
        </nav>
    </div>
}

<script type="text/javascript">
    function bildirimOkundu(id) {
        $.ajax({
            url: "/Hediye/KullaniciHediyeSil/" + id,
            type: "GET",
            dataType: 'json',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            success: function (data) {
                if (data.error == true) {
                    if (data.operation == "message") {
                        Swal.fire({
                            icon: 'error',
                            title: 'Upps',
                            text: data.message,
                            confirmButtonText: "Tamam"
                        })
                    }
                }
                else {
                    hediyeSepetiGetir();

                    var hediyeSepetiSayi = $('#hediyeSepetiSayi').text();
                    $('#hediyeSepetiSayi').text(hediyeSepetiSayi - 1);

                    Swal.fire({
                        icon: 'success',
                        title: 'Evvet!',
                        text: "Hediye sepetinizden kaldırıldı.",
                        confirmButtonText: "Tamam"
                    })
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                console.log("hata!");
            }
        });
    }

    function TumBildirimleriSil() {
        $.ajax({
            url: "/Kullanici/KullaniciTumBildirimleriSil/",
            type: "POST",
            dataType: 'json',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            success: function (data) {
                if (data == false) {
                    if (data.operation == "message") {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Bildirim Silme',
                            text: 'Bildirim silerken bir hata oluştu!',
                            confirmButtonText: "Tamam"
                        })
                    }
                }
                else {
                    bildirimleriGetir();

                    Swal.fire({
                        icon: 'success',
                        title: 'Evet!',
                        text: "Bildirimleriniz kaldırıldı.",
                        confirmButtonText: "Tamam"
                    })
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                console.log("hata!");
            }
        });
    }

    function onAjaxBegin(data, status, xhr) {
        showLoading();
    }

    function onAjaxSuccess(data, status, xhr) {
        hideLoading();

        var middleContent = $('#middleContent');
        middleContent.html('');
        middleContent.html(data);
    }

    function onAjaxFailure(xhr, status, error) {
        $("#targetElement").html("<strong>İşlem sırasında bir hata oluştu:" + error + "<br/>.</strong>");
    }
</script>
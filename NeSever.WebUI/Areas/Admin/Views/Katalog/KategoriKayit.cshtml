@{
    ViewData["Title"] = "Kayit";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}
@model NeSever.Common.Models.Urun.KategoriVM
<div class="d-flex flex-row flex-column-fluid container">
    <div class="main d-flex flex-column flex-row-fluid">
        <div class="subheader py-2 py-lg-4 subheader-transparent" id="kt_subheader">
            <div class="container d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
                <div class="d-flex align-items-center flex-wrap mr-1">
                    <div class="d-flex align-items-baseline flex-wrap mr-5">
                        <h5 class="text-dark font-weight-bold my-1 mr-5">Kategori Kayıt</h5>

                        <ul class="breadcrumb breadcrumb-transparent breadcrumb-dot font-weight-bold p-0 my-2 font-size-sm">
                            <li class="breadcrumb-item">
                                <a href="Admin/Katalog" class="text-muted">Katolog</a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="/Admin/Katalog/KategoriKayit" class="text-muted">Kategori Kayıt</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="d-flex align-items-center">
                    <a href="#" class="btn btn-icon btn-circle btn-sm btn-light-success mr-1" data-card-tool="reload" onclick="loadPage()">
                        <i class="ki ki-reload icon-nm"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="content flex-column-fluid" id="kt_content">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card card-custom gutter-b example example-compact">
                        <div class="card-header">
                            <h3 class="card-title">Kayıt Alanları</h3>
                            <div class="card-toolbar">
                                <div class="example-tools justify-content-center">
                                    <span class="example-copy" data-toggle="tooltip" title="" style="visibility:hidden"></span>
                                </div>
                            </div>
                        </div>
                        <form id="_form" method="post" enctype="multipart/form-data">
                            <input id="hdnKategoriId" type="hidden" value="@Model.KategoriId" />
                            <input id="hdnResimUrl" type="hidden" value="@Model.ResimUrl" />
                            <div class="card-body">
                                <div class="form-group row">
                                    <div class="col-lg-6">
                                        <label><span class="text-danger">* </span>Kategori Adı:</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" placeholder="" asp-for="KategoriAdi" />
                                            <div class="input-group-append">
                                                <span class="input-group-text">
                                                    <i class="la la-bookmark-o"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <label>Üst Kategori:</label>
                                        <div class="input-group">
                                            <select asp-for="UstKategoriId" asp-items="@(new SelectList(Model.UstKategoriListesi,"KategoriId","KategoriAdi"))" class="form-control selectpicker">
                                                <option>
                                                    Lütfen Seçiniz
                                                </option>
                                            </select>
                                        </div>
                                    </div>

                                </div>
                                <div class="form-group row">
                                    <div class="form-group row">
                                        <div class="col-lg-6">
                                            <label>Açıklama :</label>
                                            <div class="input-group">
                                                <textarea id="Aciklama" asp-for="Aciklama"></textarea>
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <label>Anasayfada Gösterilsin Mi?:</label>
                                            <div class="input-group">
                                                <label class="checkbox checkbox-lg">
                                                    <input asp-for="AnasayfadaGoster" type="checkbox">
                                                    <span></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-lg-3">
                                            <label>Sabit Kategori Mi?:</label>
                                            <div class="input-group">
                                                <input asp-for="SabitKategori" data-switch="true" type="checkbox" data-on-color="success" data-off-color="danger" data-on-text="Evet" data-off-text="Hayır" />

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-lg-4">
                                        <label>Meta Keywords:</label>
                                        <div class="input-group">
                                            <input type="text" asp-for="MetaKeywords" class="form-control" placeholder="" />
                                            <div class="input-group-append">
                                                <span class="input-group-text">
                                                    <i class="la la-map-marker"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <label>Meta Description:</label>
                                        <div class="input-group">
                                            <input type="text" asp-for="MetaDescription" class="form-control" placeholder="" />
                                            <div class="input-group-append">
                                                <span class="input-group-text">
                                                    <i class="la la-map-marker"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <label>Meta Title:</label>
                                        <div class="input-group">
                                            <input type="text" asp-for="MetaTitle" class="form-control" placeholder="" />
                                            <div class="input-group-append">
                                                <span class="input-group-text">
                                                    <i class="la la-map-marker"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">

                                    <div class="col-lg-4">
                                        <label>Sıra:</label>
                                        <div class="input-group">
                                            <input class="form-control" type="number" asp-for="Sira" placeholder="0">
                                            <div class="input-group-append">
                                                <span class="input-group-text">
                                                    <i class="la la-sort-numeric-down"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <label><span class="text-danger">* </span>Parametre:</label>
                                        <div class="input-group">
                                            <input type="text" asp-for="Parametre" class="form-control" placeholder="" />
                                            <div class="input-group-append">
                                                <span class="input-group-text">
                                                    <i class="la la-map-marker"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <label>Aktif Mi?:</label>
                                        <div class="input-group">
                                            <input asp-for="AktifMi" data-switch="true" type="checkbox" data-on-color="success" data-off-color="danger" data-on-text="Evet" data-off-text="Hayır" />
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-lg-12">
                                        <div class="fileinput fileinput-new" data-provides="fileinput">
                                            <div class="fileinput-new thumbnail" style="height: 100px; float:left;max-height:300px;max-width:300px" id="fileInputDiv">

                                                @if (string.IsNullOrEmpty(Model.ResimBase64))
                                                {

                                                    <img src="~/Themes/Admin/design/noimage.png" id="emptyFile" style="max-height:200px;max-width:150px" />

                                                }
                                                else
                                                {


                                                    {<ul>
                                                            <li>
                                                                <img style="max-height:200px;max-width:150px" src="data:image/png;base64,@Model.ResimBase64" />
                                                                <button class="btn btn-lg purple" type="button" onclick="KategoriResimSil()"><i class="fa fa-times"></i></button>
                                                            </li>




                                                        </ul>
                                                    }


                                                }
                                            </div>
                                            <div class="fileinput-preview fileinput-exists thumbnail" style=" max-height: 200px;float:left"> </div>
                                            <div style="float:left">
                                                <span class="btn default btn-file">

                                                    <input id="file" name="file" type="file">
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card-footer">
                                <div class="row">
                                    <div class="col-lg-6">
                                        @if (Model.KategoriId > 0)
                                        {
                                            <button id="btnGuncelle" type="submit" class="btn btn-success mr-2">Güncelle</button>
                                        }
                                        else
                                        {
                                            <button id="btnKaydet" type="submit" class="btn btn-primary mr-2">Kaydet</button>
                                        }
                                        <button type="button" class="btn btn-secondary" onclick='location.reload();'>İptal</button>

                                    </div>

                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="/Themes/Admin/dist/assets/plugins/custom/ckeditor/ckeditor-classic.bundle.js?v=7.0.5"></script>
    <script src="/Themes/Admin/dist/assets/js/pages/crud/forms/widgets/bootstrap-switch.js?v=7.0.5"></script>
    <script src="/Themes/Admin/dist/assets/js/pages/crud/forms/widgets/bootstrap-datepicker.js?v=7.0.5"></script>
    <script type="text/javascript">
        FormValidation.formValidation(
            document.getElementById('_form'),
            {
                fields: {
                    KategoriAdi: {
                        validators: {
                            notEmpty: {
                                message: 'Zorunlu alan'
                            }
                        },
                    },
                    Parametre: {
                        validators: {
                            notEmpty: {
                                message: 'Zorunlu alan'
                            },
                            stringLength: {
                                max: 50,
                                message: 'Karakter Sınırı Aşıldı.'
                            }
                        }
                    },
                },
                plugins: {
                    submitButton: new FormValidation.plugins.SubmitButton(),
                    bootstrap: new FormValidation.plugins.Bootstrap({
                        eleInvalidClass: '',
                        eleValidClass: '',
                    })
                }
            }
        ).on('core.form.valid', function () {

            var data = new FormData($('#_form')[0]);
            var totalFiles = document.getElementById("file").files.length;
            for (var i = 0; i < totalFiles; i++) {
                var file = document.getElementById("file").files[i];
                data.append('Resim', file);
            }
            data.append('KategoriId', $('#hdnKategoriId').val());
            data.append('AktifMi', $('#AktifMi').prop('checked'));
            data.append('AciklamaContent', Aciklama.getData());
            data.append('ResimUrl', $('#hdnResimUrl').val());

            $.ajax({
                type: "post",
                url: "/Admin/Katalog/KategoriKayit",
                data: data,
                contentType: false,
                processData: false,
                beforeSend: function () {
                    showLoading('_form');
                },
                success: function (result) {
                    hideLoading('_form');


                    if (result.id > 0) {
                        $('#hdnKategoriId').val(result.id);

                        if (result.operation == "insert") {
                            $("#btnKaydet").removeClass('btn-primary');
                            $("#btnKaydet").addClass('btn-success');
                            $("#btnKaydet").html('Güncelle');
                            window.history.pushState("", "", "KategoriKayit/" + result.id);
                        }

                        Swal.fire({
                            icon: 'success',
                            title: 'İşlem Başarılı!',
                            text: '',
                            showCloseButton: true,
                            confirmButtonText: "Tamam",
                            cancelButtonText: "İptal",
                        });
                    }
                    else {
                        Swal.fire({
                            icon: 'error',
                            title: 'İşlem Sırasında Hata Oluştu!',
                            text: '',
                            showCloseButton: true,
                            confirmButtonText: "Tamam",
                            cancelButtonText: "İptal",
                        });
                    }
                },

                error: function (err) {
                    hideLoading('_form');

                    Swal.fire(
                        "Hata",
                        "İşlem sırasında hata oluştu. " + err,
                        "error"
                    )
                }
            });


        }

        );
        var KTCkeditor1 = function () {
            //Private functions
            var demos = function () {
                ClassicEditor
                    .create(document.querySelector('#Aciklama'))
                    .then(editor => {
                        Aciklama = editor;
                    })

            }

            return {
                // public functions
                init: function () {
                    demos();
                }
            };
        }();


        // Class definition
        var KTTagify = function () {
            var demo4 = function () {
                var input = document.getElementById('kt_tagify_4');
                var tagify = new Tagify(input, {
                    pattern: /^.{0,20}$/, // Validate typed tag(s) by Regex. Here maximum chars length is defined as "20"
                    delimiters: ", ", // add new tags when a comma or a space character is entered
                    maxTags: 6,
                    blacklist: ["fuck", "shit", "pussy"],
                    keepInvalidTags: true, // do not remove invalid tags (but keep them marked as invalid)
                    whitelist: ["temple", "stun", "detective", "sign", "passion", "routine", "deck", "discriminate", "relaxation", "fraud", "attractive", "soft", "forecast", "point", "thank", "stage", "eliminate", "effective", "flood", "passive", "skilled", "separation", "contact", "compromise", "reality", "district", "nationalist", "leg", "porter", "conviction", "worker", "vegetable", "commerce", "conception", "particle", "honor", "stick", "tail", "pumpkin", "core", "mouse", "egg", "population", "unique", "behavior", "onion", "disaster", "cute", "pipe", "sock", "dialect", "horse", "swear", "owner", "cope", "global", "improvement", "artist", "shed", "constant", "bond", "brink", "shower", "spot", "inject", "bowel", "homosexual", "trust", "exclude", "tough", "sickness", "prevalence", "sister", "resolution", "cattle", "cultural", "innocent", "burial", "bundle", "thaw", "respectable", "thirsty", "exposure", "team", "creed", "facade", "calendar", "filter", "utter", "dominate", "predator", "discover", "theorist", "hospitality", "damage", "woman", "rub", "crop", "unpleasant", "halt", "inch", "birthday", "lack", "throne", "maximum", "pause", "digress", "fossil", "policy", "instrument", "trunk", "frame", "measure", "hall", "support", "convenience", "house", "partnership", "inspector", "looting", "ranch", "asset", "rally", "explicit", "leak", "monarch", "ethics", "applied", "aviation", "dentist", "great", "ethnic", "sodium", "truth", "constellation", "lease", "guide", "break", "conclusion", "button", "recording", "horizon", "council", "paradox", "bride", "weigh", "like", "noble", "transition", "accumulation", "arrow", "stitch", "academy", "glimpse", "case", "researcher", "constitutional", "notion", "bathroom", "revolutionary", "soldier", "vehicle", "betray", "gear", "pan", "quarter", "embarrassment", "golf", "shark", "constitution", "club", "college", "duty", "eaux", "know", "collection", "burst", "fun", "animal", "expectation", "persist", "insure", "tick", "account", "initiative", "tourist", "member", "example", "plant", "river", "ratio", "view", "coast", "latest", "invite", "help", "falsify", "allocation", "degree", "feel", "resort", "means", "excuse", "injury", "pupil", "shaft", "allow", "ton", "tube", "dress", "speaker", "double", "theater", "opposed", "holiday", "screw", "cutting", "picture", "laborer", "conservation", "kneel", "miracle", "primary", "nomination", "characteristic", "referral", "carbon", "valley", "hot", "climb", "wrestle", "motorist", "update", "loot", "mosquito", "delivery", "eagle", "guideline", "hurt", "feedback", "finish", "traffic", "competence", "serve", "archive", "feeling", "hope", "seal", "ear", "oven", "vote", "ballot", "study", "negative", "declaration", "particular", "pattern", "suburb", "intervention", "brake", "frequency", "drink", "affair", "contemporary", "prince", "dry", "mole", "lazy", "undermine", "radio", "legislation", "circumstance", "bear", "left", "pony", "industry", "mastermind", "criticism", "sheep", "failure", "chain", "depressed", "launch", "script", "green", "weave", "please", "surprise", "doctor", "revive", "banquet", "belong", "correction", "door", "image", "integrity", "intermediate", "sense", "formal", "cane", "gloom", "toast", "pension", "exception", "prey", "random", "nose", "predict", "needle", "satisfaction", "establish", "fit", "vigorous", "urgency", "X-ray", "equinox", "variety", "proclaim", "conceive", "bulb", "vegetarian", "available", "stake", "publicity", "strikebreaker", "portrait", "sink", "frog", "ruin", "studio", "match", "electron", "captain", "channel", "navy", "set", "recommend", "appoint", "liberal", "missile", "sample", "result", "poor", "efflux", "glance", "timetable", "advertise", "personality", "aunt", "dog"],
                    transformTag: transformTag,
                    dropdown: {
                        enabled: 3,
                    }
                });

                function transformTag(tagData) {
                    var states = [
                        'success',
                        'primary',
                        'danger',
                        'success',
                        'warning',
                        'dark',
                        'primary',
                        'info'];

                    tagData.class = 'tagify__tag tagify__tag--' + states[KTUtil.getRandomInt(0, 7)];

                    if (tagData.value.toLowerCase() == 'shit') {
                        tagData.value = 's✲✲t'
                    }
                }

                tagify.on('add', function (e) {
                    console.log(e.detail)
                });

                tagify.on('invalid', function (e) {
                    console.log(e, e.detail);
                });
            }
            return {
                init: function () {
                    demo4();
                }
            };
        }();
        function readURL(input) {
            $('#emptyFile').remove();
            $('#fileInputDiv').empty();
            $('#fileInputDiv').append('<ul style="list-style-type:circle"');
            for (var i = 0; i < input.files.length; i++) {
                if (input.files[i] && input.files[i]) {
                    var reader = new FileReader();
                    var reader = new FileReader();
                    reader.onload = function (e) {

                        $('#fileInputDiv').append('<li><img  style="max-height:200px;max-width:150px" src="' + e.target.result + '"></img></li>');
                    }
                    reader.readAsDataURL(input.files[i]);
                }

            }
            $('#fileInputDiv').append('</ul');
        }
        $("#file").change(function () {
            readURL(this);
        });
        function loadPage() {
            location.reload();
        }
        function showLoading(id) {
            KTApp.block(document.getElementById(id), {
                overlayColor: '#000000',
                state: 'danger',
                message: 'Lütfen bekleyin...'
            });
        };
        function hideLoading(id) {
            KTApp.unblock(document.getElementById(id));
        };
        jQuery(document).ready(function () {
            if ($('#hdnKategoriId').val() == 0) {
                $('#AktifMi').bootstrapSwitch('state', true);
            }

            KTCkeditor1.init();
            KTCkeditor2.init();
            KTTagify.init();



        })

        function KategoriResimSil() {
            document.getElementById("hdnResimUrl").value = "resimYok";
            $('#fileInputDiv').empty();            

        }
    </script>
}